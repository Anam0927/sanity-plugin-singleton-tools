{"version":3,"file":"index.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { definePlugin, SanityDocument } from 'sanity';\n\ninterface SingletonSchema extends SanityDocument {\n  options: {\n    singleton?: boolean;\n  };\n}\n\nconst getIsSingleton = (schema: any, schemaType: string): boolean => {\n  const documentSchema: SingletonSchema | undefined =\n    schema._original?.types?.find(\n      ({ name }: SingletonSchema) => name == schemaType\n    );\n\n  return documentSchema?.options?.singleton ?? false;\n};\n\nexport const singletonPlugin = definePlugin(options => {\n  return {\n    name: 'singleton-plugin',\n    document: {\n      newDocumentOptions: (\n        prev,\n        { schema, creationContext: { type, schemaType } }\n      ) => {\n        const singletons = schema._original?.types\n          .filter(({ options }: any) => options?.singleton)\n          .map(s => s.name);\n\n        const filterSingletons = ({ templateId }: { templateId: string }) =>\n          !singletons?.includes(templateId);\n\n        if (type == 'global') return prev.filter(filterSingletons);\n\n        return singletons?.includes(schemaType as string)\n          ? prev.filter(filterSingletons)\n          : prev;\n      },\n      actions: (prev, { schema, schemaType }) => {\n        return getIsSingleton(schema, schemaType as string)\n          ? prev.filter(({ action }: { action?: string }) =>\n              ['publish', 'unpublish', 'discardChanges', 'restore'].includes(\n                action as string\n              )\n            )\n          : prev;\n      },\n    },\n  };\n});\n"],"names":["options"],"mappings":";AAQA,MAAM,iBAAiB,CAAC,QAAa,eAAgC;AARrE,MAAA,IAAA,IAAA,IAAA;AASE,QAAM,kBACJ,MAAA,KAAA,OAAO,cAAP,OAAA,SAAA,GAAkB,UAAlB,OAAyB,SAAA,GAAA;AAAA,IACvB,CAAC,EAAE,WAA4B,QAAQ;AAAA,EAAA;AAG3C,UAAO,MAAgB,KAAA,kBAAA,OAAA,SAAA,eAAA,YAAhB,OAAyB,SAAA,GAAA,cAAzB,OAAsC,KAAA;AAC/C,GAEa,kBAAkB,aAAa,CACnC,aAAA;AAAA,EACL,MAAM;AAAA,EACN,UAAU;AAAA,IACR,oBAAoB,CAClB,MACA,EAAE,QAAQ,iBAAiB,EAAE,MAAM,WAAW,QAC3C;AAxBX,UAAA;AAyBc,YAAA,cAAa,KAAO,OAAA,cAAP,OAAkB,SAAA,GAAA,MAClC,OAAO,CAAC,EAAE,SAAAA,SAAQ,MAAWA,YAAA,OAAA,SAAAA,SAAS,SACtC,EAAA,IAAI,CAAK,MAAA,EAAE,IAER,GAAA,mBAAmB,CAAC,EAAE,WAAW,MACrC,EAAC,cAAA,QAAA,WAAY,SAAS,UAAA;AAEpB,aAAA,QAAQ,YAEL,cAAY,QAAA,WAAA,SAAS,cAFC,KAAK,OAAO,gBAAgB,IAIrD;AAAA,IACN;AAAA,IACA,SAAS,CAAC,MAAM,EAAE,QAAQ,WAAW,MAC5B,eAAe,QAAQ,UAAoB,IAC9C,KAAK;AAAA,MAAO,CAAC,EAAE,OAAO,MACpB,CAAC,WAAW,aAAa,kBAAkB,SAAS,EAAE;AAAA,QACpD;AAAA,MACF;AAAA,IAAA,IAEF;AAAA,EAER;AACF,EACD;"}