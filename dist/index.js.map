{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { definePlugin } from 'sanity';\n\nconst getIsSingleton = (schema, schemaType) => {\n  const documentSchema = schema._original?.types?.find(\n    ({ name }) => name == schemaType\n  );\n\n  return documentSchema?.options?.singleton;\n};\n\nexport const singletonPlugin = definePlugin(options => {\n  return {\n    name: 'singleton-plugin',\n    document: {\n      newDocumentOptions: (\n        prev,\n        { schema, creationContext: { type, schemaType } }\n      ) => {\n        const singletons = schema._original?.types\n          .filter(({ options }) => options?.singleton)\n          .map(s => s.name);\n\n        const filterSingletons = ({ templateId }) =>\n          !singletons?.includes(templateId);\n\n        if (type == 'global') return prev.filter(filterSingletons);\n\n        return singletons?.includes(schemaType)\n          ? prev.filter(filterSingletons)\n          : prev;\n      },\n      actions: (prev, { schema, schemaType }) => {\n        return getIsSingleton(schema, schemaType)\n          ? prev.filter(({ action }) =>\n              ['publish', 'unpublish', 'discardChanges', 'restore'].includes(\n                action\n              )\n            )\n          : prev;\n      },\n    },\n  };\n});\n"],"names":["definePlugin","options"],"mappings":";;;AAEA,MAAM,iBAAiB,CAAC,QAAQ,eAAe;AAF/C,MAAA,IAAA,IAAA;AAGE,QAAM,kBAAiB,MAAA,KAAA,OAAO,cAAP,OAAA,SAAA,GAAkB,UAAlB,OAAyB,SAAA,GAAA;AAAA,IAC9C,CAAC,EAAE,WAAW,QAAQ;AAAA,EAAA;AAGjB,UAAA,KAAA,kBAAA,OAAA,SAAA,eAAgB,YAAhB,OAAyB,SAAA,GAAA;AAClC,GAEa,kBAAkBA,OAAAA,aAAa,CACnC,aAAA;AAAA,EACL,MAAM;AAAA,EACN,UAAU;AAAA,IACR,oBAAoB,CAClB,MACA,EAAE,QAAQ,iBAAiB,EAAE,MAAM,WAAW,QAC3C;AAjBX,UAAA;AAkBc,YAAA,cAAa,KAAO,OAAA,cAAP,OAAkB,SAAA,GAAA,MAClC,OAAO,CAAC,EAAE,SAAAC,SAAQ,MAAMA,YAAA,OAAA,SAAAA,SAAS,SACjC,EAAA,IAAI,CAAK,MAAA,EAAE,IAER,GAAA,mBAAmB,CAAC,EAAE,WAAW,MACrC,EAAC,cAAA,QAAA,WAAY,SAAS,UAAA;AAEpB,aAAA,QAAQ,YAEL,cAAY,QAAA,WAAA,SAAS,cAFC,KAAK,OAAO,gBAAgB,IAIrD;AAAA,IACN;AAAA,IACA,SAAS,CAAC,MAAM,EAAE,QAAQ,WAAW,MAC5B,eAAe,QAAQ,UAAU,IACpC,KAAK;AAAA,MAAO,CAAC,EAAE,OAAO,MACpB,CAAC,WAAW,aAAa,kBAAkB,SAAS,EAAE;AAAA,QACpD;AAAA,MACF;AAAA,IAAA,IAEF;AAAA,EAER;AACF,EACD;;"}